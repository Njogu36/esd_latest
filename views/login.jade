doctype html
html(lang='en')
  head
    meta(charset='UTF-8')
    meta(content='width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no' name='viewport')
    title Login | ESD Application
    link(rel='shortcut icon' href='assets/auth/assets/img/icon.png' type='image/x-icon')
    link(rel='stylesheet' href='https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css' integrity='sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T' crossorigin='anonymous')
    link(rel='stylesheet' href='https://use.fontawesome.com/releases/v5.7.2/css/all.css' integrity='sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr' crossorigin='anonymous')
    link(rel='stylesheet' href='../node_modules/bootstrap-social/bootstrap-social.css')
    link(rel='stylesheet' href='https://app.revenuestadia.com/auth/assets/css/style.css')
   
    link(rel='stylesheet' href='https://app.revenuestadia.com/auth/assets/css/components.css')
    style. 
      .alert-error
      {
          color: #a94442;
          background-color: #f2dede;
          border-color: #ebccd1;
      }
      #end_session 
      {
        display:none
      }
      #loader1
      {
        display:none
      }
      #error 
      {
        display:none;
       
      }
      #clock 
      {
        display:none
      }
      .spinner {
        width: 40px;
        height: 40px;

        position: relative;
        margin: 100px auto;
      }

      .double-bounce1, .double-bounce2 {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background-color: #333;
        opacity: 0.6;
        position: absolute;
        top: 0;
        left: 0;
        
        -webkit-animation: sk-bounce 2.0s infinite ease-in-out;
        animation: sk-bounce 2.0s infinite ease-in-out;
      }

      .double-bounce2 {
        -webkit-animation-delay: -1.0s;
        animation-delay: -1.0s;
      }

      @-webkit-keyframes sk-bounce {
        0%, 100% { -webkit-transform: scale(0.0) }
        50% { -webkit-transform: scale(1.0) }
      }

      @keyframes sk-bounce {
        0%, 100% { 
          transform: scale(0.0);
          -webkit-transform: scale(0.0);
        } 50% { 
          transform: scale(1.0);
          -webkit-transform: scale(1.0);
        }
      }
  body
    #app
      section.section
        .container.mt-5
          
          .row
            .col-6
              .card.card-primary
                .card-header
                  h4 Login
                .card-body
                  != messages('message', locals)
                  form.needs-validation(method='POST' action='/login_post' novalidate='')
                    .form-group
                      label(for='email') Email
                      input#email.form-control(type='email' name='username' tabindex='1' required='' autofocus='')
                      
                    .form-group
                      label.control-label(for='password') Password  
                      input#password.form-control(type='password' name='password' tabindex='2' required='')
                      
                    
                    .form-group
                      button.btn.btn-primary.btn-lg.btn-block(type='submit' tabindex='4')
                        | Login
            .col-6
             .card(style='margin-top:50px') 
              .card-body 
               .row
                .col-md-12  
                  #loader1
                    .spinner
                      .double-bounce1
                      .double-bounce2
                  #error 
                   .alert.alert-danger 
                     #error_message
                  #clock
                   
                   .row 
                      
                   .row 
                    
                    .col-md-12
                     .card  
                      .card-body(style='background-color:lightblue;text-align:center') 
                       #current_time(style='font-weight:bold;font-size:1.3em')
                      
                       strong Session has started ...
                   
                      

                  #start_session
                   button.btn.btn-primary.btn-block(onclick='start_session_();') Start Session 
                  #end_session
                  //-  button.btn.btn-dark.btn-block(onclick='restart_session();') Restart Session 
                  //-  button.btn.btn-danger.btn-block(onclick='end_session();') End Session 
                  
              
              
    // General JS Scripts
    script(src='https://code.jquery.com/jquery-3.3.1.min.js' integrity='sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=' crossorigin='anonymous')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js' integrity='sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1' crossorigin='anonymous')
    script(src='https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js' integrity='sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM' crossorigin='anonymous')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/jquery.nicescroll/3.7.6/jquery.nicescroll.min.js')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js')
    //script(src="https://cdn.socket.io/4.2.0/socket.io.min.js" integrity="sha384-PiBR5S00EtOj2Lto9Uu81cmoyZqR57XcOna1oAuVuIEjzj0wpqDVfD0JA9eXlRsj" crossorigin="anonymous")
    script(src="https://js.pusher.com/7.0/pusher.min.js") 
    script(src='https://app.revenuestadia.com/auth/assets/js/stisla.js')
    script(src='https://app.revenuestadia.com/auth/assets/js/scripts.js')
    script(src='https://app.revenuestadia.com/auth/assets/js/custom.js')
    script.
      var pusher = new Pusher('ccb9776a436a9a03d270', {
        cluster: 'ap2'
      });

      var channel = pusher.subscribe('esd');

      function start_session_() {
          document.getElementById('loader1').style.display = 'block';
          document.getElementById('error').style.display = "none";
          document.getElementById('start_session').style.display = 'none';
          let failed = 0;
          let sent = 0;
          //- document.getElementById('failed').innerHTML = failed;
          //- document.getElementById('sent').innerHTML = sent;
          $.get('/session/check_data', (data) => {
              if (data.success === false) {
                  document.getElementById('loader1').style.display = 'none';
                  document.getElementById('error').style.display = "block";
                  document.getElementById('start_session').style.display = 'block';
                  document.getElementById('error_message').innerHTML = data.message;

              }
              else if (data.success === true) {
                  document.getElementById('loader1').style.display = 'none';
                  document.getElementById('error').style.display = "none";
                  document.getElementById('clock').style.display = 'block';
                  document.getElementById('end_session').style.display = 'block';
                  startTime()
                  

                  
                  $.post('/session/start_session', {
                      data: data.path
                  }, (data) => {
                      console.log(data)

                  })

                  channel.bind('failed', function (data_) {
                      if(data_.success === false)
                      {
                        failed = failed + 1

                      }
                     if(data_.success === true)
                      {
                        
                        sent = sent + 1

                      }
                      //- document.getElementById('sent').innerHTML = sent;
                      //- document.getElementById('failed').innerHTML = failed;
                  });

              }
          })
      }

      function startTime() {
          const today = new Date();
          let h = today.getHours();
          let m = today.getMinutes();
          let s = today.getSeconds();
          m = checkTime(m);
          s = checkTime(s);
          document.getElementById('current_time').innerHTML = h + ":" + m + ":" + s;
          setTimeout(startTime, 1000);
      }

      function checkTime(i) {
          if (i < 10) { i = "0" + i };  // add zero in front of numbers < 10
          return i;
      }
    
    
    
    
